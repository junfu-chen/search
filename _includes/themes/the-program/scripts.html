<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/jquery-1.10.2.min.js"><\/script>')</script>

<!-- Loading progess bar plugin -->
<!--[if !IE]> -->
	<script src="//cdnjs.cloudflare.com/ajax/libs/pace/0.4.17/pace.min.js"></script>
	<script>window.Pace || document.write('<script src="/assets/js/pace.min.js"><\/script>')</script>
<!-- <![endif]-->

<!-- Google Analytics Event tracking -->
<script>
var sendGaEvent = function(category, action, label) {
	if (label === 'undefined') {
		ga('send', 'event', category, action);
	} else {
		ga('send', 'event', category, action, label.trim());
	}
};

$('.the-header .nav-link').on('click', function() {
	sendGaEvent('Navigation Links', 'Click', this.textContent);
});
$('.the-footer .about a').on('click', function() {
	sendGaEvent('Footer Links', 'Click', this.textContent);
});
$('.the-footer .social-links > a').on('click', function() {
	sendGaEvent('Social Links', 'Click', this.title);
});
$('.tag_box.categories a').on('click', function() {
	sendGaEvent('Categories', 'Click', this.title);
});
$('.tag_box.tags a').on('click', function() {
	sendGaEvent('Tags', 'Click', this.title);
});
$('a.internal').on('click', function() {
	label = (this.getAttribute('data-ga') !== null) ? this.getAttribute('data-ga') : this.textContent;
	sendGaEvent('Internal Links', 'Click', label);
});
$('.unit-article .meta .author').on('click', function() {
	sendGaEvent('Post meta Links', 'Click', 'Author');
});
$('.unit-article .meta .license').on('click', function() {
	sendGaEvent('Post meta Links', 'Click', 'License');
});
$('.unit-article .meta .list-linear a').on('click', function() {
	if (this.getAttribute('data-ga') !== null){
		sendGaEvent('Post meta Links', 'Click', this.getAttribute('data-ga'));
	}
});
</script>

<!-- Jekyll Simple Search option -->
<script src="/assets/js/jekyll-search.jquery.js"></script>
<script>
	$(document).ready(function() {
		$('.search-field').simpleJekyllSearch({
			jsonFile : '{{ site.url }}/search.json',
			template : '<li><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></li>',
			searchResultsTitle : '<h4>{{ site.translations.search_results }}</h4>',
			noResults : '<p>{{ site.translations.search_not_found }}</p>'
		});
	});

	(function($, window, undefined) {
		var closeOverlay = function() {
			$('.search-wrapper').removeAttr('style');
			$(".search-form").toggleClass('active');
			$("body").removeClass('search-overlay');
		};

		$('.nav-global .btn-search').on('click', function() {
			$('.search-wrapper').css({ display: "block" });
			$(".search-form").toggleClass('active');
			$(".search-form").find('input').focus();
			$("body").toggleClass('search-overlay');
			sendGaEvent('Navigation Links', 'Click', 'Search');
		});

		$('.search-wrapper .btn-close').on('click', function() {
			closeOverlay();
		});

		$(document).on('keyup', function(e) {
			if(e.keyCode === 27) {
				closeOverlay();
			}
		});
	})(jQuery, window);
</script>

{% if page.utilities != null %}
	{% if page.utilities contains "show-hidden" %}
		<script>
			$('.show-hidden').on('click', function() {
				$(this).parent().next().toggleClass("hidden");
				$(this).toggleClass("hidden");
			});
		</script>
	{% endif %}

	{% if page.utilities contains "highlight" %}
		<script src="/assets/js/google-code-prettify/run_prettify.js?lang=yaml"></script>
		<script>
			$("head").append('<link rel="stylesheet" href="/assets/css/highlight.css" type="text/css" />');
			$("head").append('<link rel="stylesheet" href="/assets/js/google-code-prettify/prettify.css" type="text/css" />');
		</script>
	{% endif %}

	{% if page.utilities contains "fancybox" %}
		<script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js'></script>
		<script src='//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-buttons.min.js'></script>

		<script>window.jQuery.fancybox || document.write('<script src="/assets/js/fancybox/jquery.fancybox.pack.js?v=2.1.4"><\/script>')</script>
		<script>window.jQuery.fancybox.helpers.buttons || document.write('<script src="/assets/js/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"><\/script>')</script>

		<script>
			$("head").append('<link rel="stylesheet" href="/assets/js/fancybox/jquery.fancybox.css?v=2.1.4" type="text/css" />');
			$("head").append('<link rel="stylesheet" href="/assets/js/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" />');
			$(".post-image").fancybox({
				prevEffect : 'none',
				nextEffect : 'none',
				closeBtn : true,
				helpers : {
					title : { type : 'inside' },
					buttons : {}
				}
			});
		</script>
	{% endif %}

	{% if page.utilities contains "unveil" %}
		<script src="/assets/js/unveil/jquery.unveil.min.js"></script>
		<script>
			$(document).ready(function () {
				$(".post-image > img").unveil(450);
			});
		</script>
	{% endif %}

	{% if page.utilities contains "toc" %}
		<script>
			function createListItem(heading) {
				var link = "#" + heading.children("a").attr("id");
				return "<li>" + "<a href='" + link + "'>" + heading.text() + "</a>" + "</li>";
			}

			var ToC = "<nav role='navigation' class='toc'><ol>";
			$("article h2").each(function () {
				var secondHeading, thirdHeadingInside;

				secondHeading = $(this);
				ToC += createListItem(secondHeading);

				thirdHeadingInside = secondHeading.nextUntil("article h2", "h3");
				if (thirdHeadingInside.length !== 0) {
					ToC += "<ul>";
					thirdHeadingInside.each(function () {
						ToC += createListItem($(this));
					});
					ToC += "</ul>";
				}
			});
			ToC += "</ol>" + "</nav>";

			$("#toc").prepend(ToC);
		</script>
	{% endif %}

	{% if page.utilities contains "toc" or page.utilities contains "back-to-top" %}
		<script>
			$(document).ready(function () {
				var offset = 220, duration = 500, width = 1280;
				$(window).scroll(function () {
					if ($(window).width() > width) {
						if ($(this).scrollTop() > offset) {
							$('footer .back-to-top').fadeIn(duration);
						} else {
							$('footer .back-to-top').fadeOut(duration);
						}
					}
				});
				$(window).resize(function () {
					if ($(window).width() < width) {
						$('footer .back-to-top').fadeOut(duration);
					}
					if ($(window).width() >= width && $(this).scrollTop() > offset) {
						$('footer .back-to-top').fadeIn(duration);
					}
				});

				$('footer .back-to-top').click(function (event) {
					event.preventDefault();
					$('html, body').animate({scrollTop: 0}, duration);
					return false;
				});
			});
		</script>
	{% endif %}
{% endif %}